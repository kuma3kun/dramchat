'use strict';

var OpalFunctionPrototype = {};
var FunctionPrototype = Function.prototype;
var FunctionPrototypeKeys = Object.keys(FunctionPrototype);

// eslint-disable-next-line
var Opal = require('../lib/opal.ruby.js');
Object.keys(Function.prototype).forEach(function (key) {
    if (FunctionPrototypeKeys.indexOf(key) < 0) {
        OpalFunctionPrototype[key] = Function.prototype[key];
        delete Function.prototype[key];
    }
});

function up() {
    Object.assign(Function.prototype, OpalFunctionPrototype);
}
function down() {
    Object.keys(Function.prototype).forEach(function (key) {
        if (FunctionPrototypeKeys.indexOf(key) < 0) delete Function.prototype[key];
    });
}

module.exports = function opal(callback) {
    try {
        up();

        // eslint-disable-next-line
        var result = callback(Opal);

        down();

        return result;
    } catch (e) {
        down();
        throw e;
    }
};
//# sourceMappingURL=opal.js.map